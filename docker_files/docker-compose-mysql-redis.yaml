services:
  mariadb:
    image: mariadb:10.4
    container_name: topteenmariadb
    environment:
      MARIADB_ROOT_PASSWORD: rootpassword
      MARIADB_DATABASE: topteen12
      MARIADB_USER: root12
      MARIADB_PASSWORD: root12
    ports:
      - "3306:3306"
    volumes:
      - mariadb_data:/var/lib/mysql
      - ./custom.cnf:/etc/mysql/conf.d/custom.cnf
    networks:
      - topteen-network
  tt_redis:
      image: redis
      ports:
        - "6380:6379"
      networks:
        - topteen-network

  tt_elasticsearch:
        container_name: elasticsearch
        image: elasticsearch:7.14.2
        environment:
          - discovery.type=single-node
          - "ES_JAVA_OPTS=-Xms1024m -Xmx1024m"
          - bootstrap.memory_lock=true
        deploy:
          placement:
            constraints:
              - "node.labels.name==manager1"
        #volumes:
          #- tt_elastic_volume:/usr/share/elasticsearch/data
volumes:
  mariadb_data:
networks:
  topteen-network:
    driver: bridge